========================================
TÃ“M Táº®T Sá»¬A LOGIC PHÃ‚N QUYá»€N
QUáº¢N LÃ Váº¬N CHUYá»‚N (SHIPMENT)
========================================

NGUYÃŠN NHÃ‚N Lá»–I:
================
- Staff vÃ  Customer váº«n cÃ³ thá»ƒ truy cáº­p chá»©c nÄƒng "Quáº£n lÃ½ váº­n chuyá»ƒn"
- Chá»‰ ADMIN má»›i Ä‘Æ°á»£c phÃ©p xem chá»©c nÄƒng nÃ y


Váº¤N Äá»€ TÃŒM RA:
==============

1ï¸âƒ£ ShipmentController.java
   âŒ KhÃ´ng kiá»ƒm tra quyá»n cá»§a user
   â†’ Táº¥t cáº£ má»i ngÆ°á»i Ä‘á»u cÃ³ thá»ƒ load ShipmentView.fxml

2ï¸âƒ£ DashboardController.java
   âŒ STAFF Ä‘Æ°á»£c show nÃºt Shipment
   â†’ isStaff cÃ³ thá»ƒ click vÃ o Quáº£n lÃ½ váº­n chuyá»ƒn

3ï¸âƒ£ ShipmentView.fxml
   âŒ KhÃ´ng cÃ³ cÆ¡ cháº¿ áº©n/hiá»‡n dá»±a trÃªn role


CÃC FILE ÄÃƒ Sá»¬A:
================

1ï¸âƒ£ ShipmentController.java
   âœ… ThÃªm import: Dinh_User
   âœ… ThÃªm phÆ°Æ¡ng thá»©c: isAdmin(Dinh_User user)
   âœ… ThÃªm phÆ°Æ¡ng thá»©c: disableAllControls()
   âœ… Sá»­a initialize():
      - Kiá»ƒm tra user tá»« SessionManager
      - Náº¿u khÃ´ng pháº£i ADMIN â†’ show alert + disable controls
      - Náº¿u lÃ  ADMIN â†’ load data bÃ¬nh thÆ°á»ng
   âœ… ThÃªm debug log Ä‘á»ƒ kiá»ƒm tra quyá»n

2ï¸âƒ£ DashboardController.java
   âœ… Sá»­a applyPermissions():
      - ADMIN: Tháº¥y táº¥t cáº£ nÃºt (btnShipment visible)
      - STAFF: âŒ KhÃ´ng tháº¥y btnShipment (chá»‰ Category, Product)
      - CUSTOMER: KhÃ´ng tháº¥y btnShipment (chá»‰ Cart, Order, Payment)


FLOW Xá»¬ LÃ QUYá»€N (Äáº¦Y Äá»¦):
============================

1. NgÆ°á»i dÃ¹ng Ä‘Äƒng nháº­p â†’ SessionManager lÆ°u user + roles

2. Má»Ÿ Dashboard â†’ DashboardController.initialize()
   â†’ applyPermissions(user)
   â†’ Kiá»ƒm tra role:
      - ADMIN:    Show All Buttons (including Shipment)
      - STAFF:    Show Category + Product (NO Shipment)
      - CUSTOMER: Show Cart + Order + Payment (NO Shipment)

3. STAFF/CUSTOMER khÃ´ng tháº¥y nÃºt Shipment
   âœ… KhÃ´ng thá»ƒ click vÃ o

4. ADMIN click "Quáº£n lÃ½ váº­n chuyá»ƒn"
   â†’ loadView("ShipmentView.fxml")
   â†’ ShipmentController.initialize()
      â†’ Kiá»ƒm tra láº§n ná»¯a: currentUser lÃ  ADMIN?
      â†’ YES â†’ Load dá»¯ liá»‡u váº­n chuyá»ƒn
      â†’ NO â†’ Show alert + disable controls

5. Náº¿u STAFF/CUSTOMER cá»‘ gáº¯ng truy cáº­p trá»±c tiáº¿p qua code
   â†’ ShipmentController cháº·n + show alert
   âœ… An toÃ n 2 lá»›p


Báº¢NG PHÃ‚N QUYá»€N:
================

| Chá»©c nÄƒng | ADMIN | STAFF | CUSTOMER |
|-----------|-------|-------|----------|
| User Management | âœ… | âŒ | âŒ |
| Audit Log | âœ… | âŒ | âŒ |
| Category Management | âœ… | âœ… | âŒ |
| Product Management | âœ… | âœ… | âŒ |
| Report | âœ… | âŒ | âŒ |
| Payment Management | âœ… | âŒ | âœ… (Personal) |
| **Shipment Management** | âœ… | âŒ | âŒ |
| Cart | âœ… | âŒ | âœ… |
| Order List | âœ… | âŒ | âœ… (Personal) |


CÃC BÆ¯á»šC KIá»‚M TRA:
==================

BÆ°á»›c 1: Build & Run
  - Eclipse: Project â†’ Clean â†’ Build All
  - Cháº¡y á»©ng dá»¥ng

BÆ°á»›c 2: ÄÄƒng nháº­p vá»›i tÃ i khoáº£n ADMIN
  - Username: dinh_admin_v2 (hoáº·c user ADMIN khÃ¡c)
  - Má»Ÿ Dashboard
  - âœ… NÃªn tháº¥y nÃºt "Quáº£n lÃ½ váº­n chuyá»ƒn"
  - Click vÃ o â†’ Xem dá»¯ liá»‡u shipments
  - Console: âœ… [PERMISSION] User lÃ  ADMIN - Cho phÃ©p truy cáº­p

BÆ°á»›c 3: ÄÄƒng nháº­p vá»›i tÃ i khoáº£n STAFF
  - Username: (staff account)
  - Má»Ÿ Dashboard
  - âŒ NÃªn NOT tháº¥y nÃºt "Quáº£n lÃ½ váº­n chuyá»ƒn"
  - Chá»‰ tháº¥y: Category, Product

BÆ°á»›c 4: ÄÄƒng nháº­p vá»›i tÃ i khoáº£n CUSTOMER
  - Username: (customer account)
  - Má»Ÿ Dashboard
  - âŒ NÃªn NOT tháº¥y nÃºt "Quáº£n lÃ½ váº­n chuyá»ƒn"
  - Chá»‰ tháº¥y: Cart, Order List, Payment

BÆ°á»›c 5: Bypass Check (Optional - Ä‘á»ƒ test an toÃ n)
  - Náº¿u STAFF/CUSTOMER cá»‘ tÃ¬nh gá»i ShipmentView
  - Alert: "Chá»‰ quáº£n trá»‹ viÃªn má»›i cÃ³ thá»ƒ truy cáº­p chá»©c nÄƒng nÃ y!"
  - CÃ¡c control bá»‹ disable
  - âœ… An toÃ n


Lá»–I CÃ“ THá»‚ Gáº¶P:
================

âŒ "Lá»—i: KhÃ´ng tÃ¬m tháº¥y file ShipmentView.fxml"
   â†’ Äáº£m báº£o file tá»“n táº¡i: src/main/resources/fxml/ShipmentView.fxml
   â†’ Rebuild project

âŒ STAFF/CUSTOMER váº«n tháº¥y nÃºt Shipment
   â†’ Check: DashboardController Ä‘Ã£ rebuild?
   â†’ Check console: CÃ³ in role cá»§a user khÃ´ng?
   â†’ Restart á»©ng dá»¥ng

âŒ ADMIN click vÃ o nhÆ°ng khÃ´ng tháº¥y dá»¯ liá»‡u
   â†’ Check database: CÃ³ shipments khÃ´ng?
   â†’ Check console: CÃ³ lá»—i SQL khÃ´ng?
   â†’ Cháº¡y: SELECT COUNT(*) FROM shipments;

âŒ Alert hiá»‡n lÃªn nhÆ°ng khÃ´ng disable
   â†’ Check: disableAllControls() cÃ³ Ä‘Æ°á»£c gá»i?
   â†’ Check: tableShipments & cbStatus cÃ³ fx:id khÃ´ng?


KIá»‚M TRA DATABASE:
==================

Xem cÃ¡c user vÃ  role:

```sql
SELECT u.user_id, u.username, GROUP_CONCAT(r.role_name) as roles
FROM users u
LEFT JOIN user_roles ur ON u.user_id = ur.user_id
LEFT JOIN roles r ON ur.role_id = r.role_id
GROUP BY u.user_id;
```

NÃªn tháº¥y:
- dinh_admin_v2: ADMIN
- (staff user): STAFF
- (customer user): CUSTOMER


DEBUG LOG:
==========

Khi cháº¡y, má»Ÿ Console sáº½ tháº¥y:

ADMIN:
  ğŸ” [PERMISSION] Kiá»ƒm tra user: dinh_admin_v2
    - Role: ADMIN
  âœ… [PERMISSION] User lÃ  ADMIN - Cho phÃ©p truy cáº­p

STAFF:
  ğŸ” [PERMISSION] Kiá»ƒm tra user: staff_user
    - Role: STAFF
  âŒ [PERMISSION] User khÃ´ng cÃ³ role ADMIN

CUSTOMER:
  ğŸ” [PERMISSION] Kiá»ƒm tra user: customer_user
    - Role: CUSTOMER
  âŒ [PERMISSION] User khÃ´ng cÃ³ role ADMIN


TÃNH NÄ‚NG Báº¢O Máº¬T:
==================

âœ… 2 lá»›p báº£o vá»‡:
   1. DashboardController: áº¨n nÃºt Shipment khá»i STAFF/CUSTOMER
   2. ShipmentController: Kiá»ƒm tra quyá»n khi load view

âœ… Debug log giÃºp tracking:
   - Xem role cá»§a user
   - Xem quyá»n Ä‘Æ°á»£c cáº¥p

âœ… Disable controls náº¿u khÃ´ng Ä‘á»§ quyá»n:
   - Table khÃ´ng interactive
   - Combo box khÃ´ng thay Ä‘á»•i Ä‘Æ°á»£c

âœ… Alert thÃ´ng bÃ¡o:
   - User biáº¿t táº¡i sao khÃ´ng thá»ƒ truy cáº­p


KIá»‚M TRA HOÃ€N THÃ€NH:
====================

âœ“ ShipmentController.java Ä‘Ã£ thÃªm kiá»ƒm tra quyá»n
âœ“ DashboardController.java Ä‘Ã£ sá»­a logic STAFF
âœ“ Only ADMIN can see Shipment button
âœ“ Only ADMIN can access ShipmentView
âœ“ STAFF/CUSTOMER Ä‘Æ°á»£c protect
âœ“ Debug log Ä‘á»ƒ troubleshoot


HÃ£y build láº¡i vÃ  test vá»›i cÃ¡c user khÃ¡c nhau! ğŸ”’ğŸš€
